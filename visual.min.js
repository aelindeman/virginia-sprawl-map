"use strict";!function(){function a(b){return this instanceof a?(this.data=b,this.legend={area:{title:"Change in consumed land",units:"km²",scale:[-1,0,60,120,180],legend:[!1,"1 - 60","61 - 120","121 - 180","181 - 255"]},pop:{title:"Proportion of state population",units:"%",scale:[-1,0,.005,.01,.02],legend:["decrease","0 - 0.5%","0.5% - 1%","1% - 2%","2% +"]}},this.county_name_placeholder=$("h3.county-name").text(),this.register_svg_helper_data(),this.register_svg_click_handlers(),this.register_map_picker_handlers(),void($(".map-panel input").is(":checked")&&(this.draw_map($(".map-panel input:checked:first").val()),$(".map-panel .legend").fadeIn(375)))):new a(b)}a.prototype.VERSION="0.2.0",a.prototype.register_svg_helper_data=function(){$(document.getElementById("map")).ready(function(){$("#county_outlines > g[id], #county_outlines > path[id]").each(function(){var a=$(this),b=a.attr("id");if(null!==a.attr("id").match(/^[A-Za-z_]+$/g)){var c=a.attr("id").replace(/_/g," ").replace(/Ci$/g," City");a.attr({title:c}),a.data({name:c,lookup:b})}})})},a.prototype.register_svg_click_handlers=function(){var a=this,b=$("#info .county-name"),c=$("#info ul");$("#county_outlines > g[id], #county_outlines > path[id]").not(".county-selected").on("click",function(d){if(b.text()!=$(this).attr("id").replace(/_/g," ").replace(/Ci$/g," City")){var e;(e=document.querySelector(".county-selected"))&&lunar.removeClass(e,"county-selected"),lunar.addClass(this,"county-selected");var f=$(this).data("lookup"),g=$(this).data("name");c.delay(125).fadeIn(375),b.animate({opacity:0},125,function(){a.draw_panel(f),b.addClass("county-selected").text(g);var c=Math.max(0,$("#notes").position().top-$(window).height());$("html, body").animate({scrollTop:c},375)}).animate({opacity:1},375)}}),$("#map svg").on("click",function(d){if("path"!=d.target.nodeName){var e;(e=document.querySelector(".county-selected"))&&lunar.removeClass(e,"county-selected"),b.text()!=a.county_name_placeholder&&(c.fadeOut(125),b.animate({opacity:0},125,function(){$(this).removeClass("county-selected").text(a.county_name_placeholder)}).animate({opacity:1},750))}}),c.hide()},a.prototype.register_map_picker_handlers=function(){var a=this;$(".map-panel input").on("change",function(){$(".map-panel .legend").fadeOut(125,function(){var b=$(".map-panel input:checked:first").val();a.draw_map(b)}).fadeIn(375)})},a.prototype.draw_map=function(a){var b=this;a="string"==typeof a?a:$(".map-panel input:checked:first").val(),this.draw_legend(a),$("#county_outlines > g[id], #county_outlines > path[id]").each(function(c,d){var e=$(this).attr("id").replace(/_/g," ").replace(/Ci$/g," city"),f="area"==a?b.lookup(e,"not5to5_sqkm"):"pop"==a?b.lookup(e,"pct_change_rel"):null,g=b.legend[a].scale,h=g.length;if(f)for(;0<h--&&!(f>g[h]););if("object"==typeof lunar&&lunar instanceof Object){for(var i=0;5>i;i++)lunar.hasClass(this,"value-"+i)&&lunar.removeClass(this,"value-"+i);lunar.hasClass(this,"scale")||lunar.addClass(this,"scale"),lunar.addClass(this,"value-"+h)}else console.warn("lunar not loaded, so can't add classes to svg elements - see https://github.com/toddmotto/lunar")})},a.prototype.draw_legend=function(a){for(var b=0;b<this.legend[a].legend.length;b++){var c;0!=(c=this.legend[a].legend[b])?$(".legend li.value-"+b).text(c).show():$(".legend li.value-"+b).hide()}},a.prototype.lookup=function(a,b){a=a.replace(/_/g," ").replace(/Ci$/g," city")||null;for(var c=0;c<this.data.length;c++)if(this.data[c].label.slice(0,a.length).toLowerCase()==a.toLowerCase())return void 0!==b&&this.data[c].hasOwnProperty(b)?this.data[c][b]:this.data[c];return null},a.prototype.draw_panel=function(a){a=this.lookup(a);var b=750,c=",",d="easeOutCubic";$(".population-change").numerator({toValue:100*(a.pct_change-1),duration:b,rounding:1,easing:d}),$(".population-raw-1990").numerator({toValue:a.pop_1990,duration:b,delimiter:c,easing:d}),$(".population-raw-2010").numerator({toValue:a.pop_2010,duration:b,delimiter:c,easing:d}),$(".population-change-relative").numerator({toValue:100*a.pct_change_rel,duration:b,rounding:2,delimiter:c,easing:d}),$(".developed-land-change").numerator({toValue:100*a.pct5_increase,duration:b,rounding:1,easing:d}),$(".developed-land-1992").numerator({toValue:a.already5_sqkm,duration:b,rounding:1,easing:d}),$(".developed-land-2006").numerator({toValue:a.total5_sqkm,duration:b,rounding:1,easing:d}),$(".developed-land-relative").numerator({toValue:100*a.pct5_increase_relative,duration:b,rounding:2,easing:d})},"object"==typeof window&&"object"==typeof window.document&&(window.VizHelper=a)}();